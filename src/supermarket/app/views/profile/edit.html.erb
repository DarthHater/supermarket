<%= provide(:title, "Manage Profile") %>

<div class="page profile" data-equalizer>
  <%= render 'users/sidebar' %>

  <div class="main" data-equalizer-watch>
    <h1>Manage Profile</h1>

    <dl class="tabs radius" data-tab data-options="deep_linking:true">
      <dd class="active"><a href="#profile" rel="manage_profile">Edit Profile</a></dd>
      <dd><a href="#collaborations" rel="manage_collaborations">Collaborations</a></dd>
      <dd><a href="#keys" rel="manage_keys">Keys</a></dd>
    </dl>

    <div class="tabs-content">
      <div class="content active" id="profile">
        <%= form_for(prep_email_preferences(current_user), url: profile_path, html: { 'data-abide' => true }) do |f| %>
          <%= render 'application/form_errors', record: current_user %>

          <p>Your email, password and name are maintained and managed by your Chef account. <%= link_to 'Edit them here.', chef_profile_url %> They will be updated the next time you sign in to Supermarket. Avatars are powered by <%= link_to 'Gravatar', 'https://www.gravatar.com' %>.</p>

          <fieldset>
            <div class="company-field">
              <%= f.text_field :company, placeholder: 'Company', title: 'Company' %>
            </div>
            <div class="twitterusername-field">
              <%= f.text_field :twitter_username, placeholder: 'Twitter Username', title: 'twitter username' %>
            </div>
            <div class="ircnickname-field">
              <%= f.text_field :irc_nickname, placeholder: 'IRC Nickname', title: 'irc nickname' %>
            </div>
            <div class="jirausername-field">
              <%= f.text_field :jira_username, placeholder: 'JIRA Username', title: 'jira username' %>
            </div>
          </fieldset>
          <fieldset>
            Email Preferences<br><br>
            <%= f.fields_for :email_preferences, sorted_email_preferences(f.object) do |ff| %>
              <div>
                <%= ff.check_box :_destroy, { checked: ff.object.persisted? }, '0', '1' %>
                <%= ff.label :_destroy, ff.object.system_email.name %>
                <%= ff.hidden_field :system_email_id %>
              </div>
            <% end %>
          </fieldset>
          <%= f.submit 'Update Profile', class: 'button primary radius' %>
        <% end %>
      </div>
      <div class="content" id="collaborations">
        <% if current_user.collaborated_cookbooks.empty? %>
          <p>You are currently not a collaborator on any resources. Once you are, they will be listed here.</p>
        <% else %>
          <p>The resources you are a collaborator on.</p>

          <table>
            <% current_user.collaborators.each do |collaborator| %>
              <tr>
                <td><%= link_to collaborator.resourceable.name, collaborator.resourceable %></td>
                <td><%= collaborator.resourceable.class.name %></td>
                <td class="text-right"><%= link_to 'Remove Myself as a Collaborator', collaborator_path(collaborator), remote: true, method: :delete, class: 'button tiny alert radius', rel: 'remove_collaboration' %></td>
              </tr>
            <% end %>
          </table>
        <% end %>
      </div>
      <div class="content" id="keys">
        <p>The credentials to authenticate with Supermarket are the same ones
        used to authenticate with the Chef server. E.g. if you wish to upload
        cookbooks to supermarket.chef.io you need to use the same username
        and client key that you use to authenticate with manage.chef.io.
        </p>
        <p>If you do not already have your keys, or don't know if you do, you
        can reset your key here:
        </p>
        <ol>
          <li>Login or create an account at: <a href="https://manage.chef.io/login">manage.chef.io/login</a></li>
          <li>Login to Chef's Identity Service at: <a href="https://id.chef.io/id/signin">https://id.chef.io/id/signin</a></li>
          <li>Visit your Chef account profile: <a href="https://id.chef.io/id/profile">id.chef.io/id/profile</a></li>
          <li>Click on <emph>Get a New Key</emph>. This will reset your client
          key.</li>
          <li>Use this key to configure knife to authenticate with the public Chef
          server as you normally would.</li>
          <li>You should now be configured to authenticate with Supermarket.</li>
        </ol>
      </div>
    </div>
  </div>
</div>
